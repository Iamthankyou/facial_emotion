{"ast":null,"code":"import _slicedToArray from\"/home/beter/OutSource/Folder/webapp/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _regeneratorRuntime from\"/home/beter/OutSource/Folder/webapp/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/beter/OutSource/Folder/webapp/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import React,{useRef,useState,useEffect}from'react';import'./App.css';import{loadModels,detectFaces,drawResults}from\"./Face API/faceApi\";import*as tf from'@tensorflow/tfjs';import loading from'./Assets/loading.gif';import Camera from\"./Camera/Camera\";import Switch from\"react-switch\";import{FontAwesomeIcon}from\"@fortawesome/react-fontawesome\";import{createFaLibrary}from\"./icons\";loadModels();createFaLibrary();function App(){var MODEL_PATH='./jsmodel/model.json';var INDEXEDDB_DB='tensorflowjs';var INDEXEDDB_STORE='model_info_store';var INDEXEDDB_KEY='web-model';var photoMode=false;useEffect(function(){loadmodel().then(function(){setisDownloadingModel(false);getResults();});},[]);var clearOverlay=function clearOverlay(canvas){canvas.current.getContext(\"2d\").clearRect(0,0,canvas.width,canvas.height);};var getResults=function getResults(){if(!photoMode&&camera!==null){var ticking=setInterval(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return getFaces();case 2:case\"end\":return _context.stop();}}},_callee);})),200);return function(){clearOverlay(cameraCanvas);clearInterval(ticking);};}else{return clearOverlay(cameraCanvas);}};var getFaces=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var faces,src,results,expressions,max,index;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!(camera.current!==null)){_context2.next=11;break;}_context2.next=3;return detectFaces(camera.current.video);case 3:faces=_context2.sent;src=camera.current.getScreenshot();_context2.next=7;return drawResults(camera.current.video,cameraCanvas.current,faces,\"boxLandmarks\",src,facecanvas,model);case 7:results=_context2.sent;expressions=[\"angry\",\"disgusted\",\"afraid\",\"happy\",\"sad\",\"surprised\",\"neutral\"];if(results!==undefined){max=results.reduce(function(a,b){return Math.max(a,b);});index=results.indexOf(max);setoutput(expressions[index]);}setResult(faces);case 11:case\"end\":return _context2.stop();}}},_callee2);}));return function getFaces(){return _ref2.apply(this,arguments);};}();var model=null;var modelLastUpdated=null;var aspectRatio=window.innerWidth/window.innerHeight;var getExpression=function getExpression(){setexpression(output);if(camera){var src=camera.current.getScreenshot();}setvideo(false);setcurrent(src);};var reCapture=function reCapture(){setvideo(true);};var loadmodel=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:console.log(window.innerWidth,\"innnnnnnner\");if(!('indexedDB'in window)){_context3.next=17;break;}_context3.prev=2;_context3.next=5;return tf.loadLayersModel('indexeddb://'+INDEXEDDB_KEY);case 5:model=_context3.sent;_context3.next=15;break;case 8:_context3.prev=8;_context3.t0=_context3[\"catch\"](2);console.log(_context3.t0);_context3.next=13;return tf.loadLayersModel(MODEL_PATH);case 13:model=_context3.sent;model.save('indexeddb://'+INDEXEDDB_KEY);case 15:_context3.next=21;break;case 17:console.warn('IndexedDB not supported.');_context3.next=20;return tf.loadLayersModel(MODEL_PATH);case 20:model=_context3.sent;case 21:setmodelLoaded(true);console.log(\"model loaded\");case 23:case\"end\":return _context3.stop();}}},_callee3,null,[[2,8]]);}));return function loadmodel(){return _ref3.apply(this,arguments);};}();var camera=useRef();var cameraCanvas=useRef();var facecanvas=useRef();var _useState=useState([]),_useState2=_slicedToArray(_useState,2),result=_useState2[0],setResult=_useState2[1];var _useState3=useState(true),_useState4=_slicedToArray(_useState3,2),isDownloadingModel=_useState4[0],setisDownloadingModel=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),modelLoaded=_useState6[0],setmodelLoaded=_useState6[1];var _useState7=useState(\"\"),_useState8=_slicedToArray(_useState7,2),output=_useState8[0],setoutput=_useState8[1];var _useState9=useState(\"\"),_useState10=_slicedToArray(_useState9,2),expression=_useState10[0],setexpression=_useState10[1];var _useState11=useState(null),_useState12=_slicedToArray(_useState11,2),current=_useState12[0],setcurrent=_useState12[1];var _useState13=useState(true),_useState14=_slicedToArray(_useState13,2),video=_useState14[0],setvideo=_useState14[1];var _useState15=useState(false),_useState16=_slicedToArray(_useState15,2),mode=_useState16[0],setMode=_useState16[1];return React.createElement(\"div\",null,isDownloadingModel&&React.createElement(\"div\",{style:{textAlign:\"center\",marginTop:\"30vh\"}},React.createElement(\"img\",{src:loading}),React.createElement(\"h2\",{style:{color:\"#007c6c\"}},\"Downloading Model\")),!isDownloadingModel&&React.createElement(\"div\",null,React.createElement(\"div\",{className:\"titleDiv\"},React.createElement(\"div\",{style:{marginLeft:\"10px\",marginTop:\"1vh\"}},React.createElement(\"h4\",{style:{fontSize:\"4vh\"}},\"Facial Emotion Detector\"),React.createElement(\"a\",{className:\"nostyle\",href:\"https://github.com/amilkh/cs230-fer\"},\"Deep learning model\"),React.createElement(\"p\",{className:\"nostyle\"},\"\\xA0by\\xA0\"),React.createElement(\"a\",{className:\"nostyle\",href:\"https://cs230.stanford.edu/\"},\"Stanford University\"),React.createElement(\"br\",null),React.createElement(\"a\",{className:\"nostyle\",href:\"https://github.com/amilkh/cs230-fer/tree/master/webapp\"},\"Web app\"),React.createElement(\"p\",{className:\"nostyle\"},\"\\xA0by\\xA0\"),React.createElement(\"a\",{className:\"nostyle\",href:\"https://se.neduet.edu.pk/\"},\"NED University\"),React.createElement(\"div\",{style:{marginLeft:aspectRatio>1?\"92vw\":\"80vw\"}},React.createElement(Switch,{onChange:function onChange(){setMode(!mode);reCapture();},uncheckedIcon:React.createElement(FontAwesomeIcon,{style:{marginLeft:\"8px\",marginTop:\"5px\"},icon:\"video\"}),checkedIcon:React.createElement(FontAwesomeIcon,{style:{marginLeft:\"10px\",marginTop:\"5px\"},icon:\"camera\"}),checked:!mode,className:\"App__switcher-switch\",offColor:\"#b3f5e5\",onColor:\"#b3f5e5\",width:60})))),React.createElement(\"div\",{className:\"camera\",align:\"center\"},React.createElement(\"div\",{id:\"cam_input\"},React.createElement(\"div\",{style:{display:video?\"block\":\"none\"}},React.createElement(Camera,{camera:camera,cameraCanvas:cameraCanvas})),!video&&React.createElement(\"img\",{className:\"camera\",src:current})),!mode&&React.createElement(\"div\",null,video&&React.createElement(\"button\",{style:{width:aspectRatio>1?window.innerWidth/100*80:\"33vh\"},className:\"detect\",onClick:function onClick(){return getExpression();}},\"Detect My Emotion\"),!video&&React.createElement(\"button\",{style:{width:aspectRatio>1?window.innerWidth/100*80:\"33vh\"},className:\"detect\",onClick:function onClick(){return reCapture();}},\"Capture Again\"))),React.createElement(\"div\",{className:\"footer\"},mode&&output!==\"\"&&React.createElement(\"h3\",null,\"I think you look \",output,\".\"),!mode&&expression!==\"\"&&React.createElement(\"h3\",null,\"I think you look \",expression,\".\"))));}export default App;","map":{"version":3,"sources":["/home/beter/OutSource/Folder/webapp/src/App.js"],"names":["React","useRef","useState","useEffect","loadModels","detectFaces","drawResults","tf","loading","Camera","Switch","FontAwesomeIcon","createFaLibrary","App","MODEL_PATH","INDEXEDDB_DB","INDEXEDDB_STORE","INDEXEDDB_KEY","photoMode","loadmodel","then","setisDownloadingModel","getResults","clearOverlay","canvas","current","getContext","clearRect","width","height","camera","ticking","setInterval","getFaces","cameraCanvas","clearInterval","video","faces","src","getScreenshot","facecanvas","model","results","expressions","undefined","max","reduce","a","b","Math","index","indexOf","setoutput","setResult","modelLastUpdated","aspectRatio","window","innerWidth","innerHeight","getExpression","setexpression","output","setvideo","setcurrent","reCapture","console","log","loadLayersModel","save","warn","setmodelLoaded","result","isDownloadingModel","modelLoaded","expression","mode","setMode","textAlign","marginTop","color","marginLeft","fontSize","display"],"mappings":"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","sourcesContent":["import React, { useRef, useState, useEffect } from 'react';\nimport './App.css';\nimport { loadModels, detectFaces, drawResults } from \"./Face API/faceApi\";\nimport * as tf from '@tensorflow/tfjs';\nimport loading from './Assets/loading.gif'\nimport Camera from \"./Camera/Camera\"\nimport Switch from \"react-switch\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport { createFaLibrary } from \"./icons\";\n\n\n\n\n\n\nloadModels();\ncreateFaLibrary();\nfunction App() {\n\n  const MODEL_PATH = './jsmodel/model.json';\n\n  const INDEXEDDB_DB = 'tensorflowjs';\n  const INDEXEDDB_STORE = 'model_info_store';\n  const INDEXEDDB_KEY = 'web-model';\n\n  const photoMode = false\n  useEffect(() => {\n    loadmodel().then(() => {\n      setisDownloadingModel(false)\n      getResults()\n    })\n  }, []);\n\n\n\n\n  const clearOverlay = canvas => {\n    canvas.current\n      .getContext(\"2d\")\n      .clearRect(0, 0, canvas.width, canvas.height);\n  };\n\n\n  const getResults = () => {\n    if (!photoMode && camera !== null) {\n      const ticking = setInterval(async () => {\n        await getFaces();\n      }, 200);\n      return () => {\n        clearOverlay(cameraCanvas);\n        clearInterval(ticking);\n      };\n    } else {\n      return clearOverlay(cameraCanvas);\n    }\n  }\n\n\n  const getFaces = async () => {\n    if (camera.current !== null) {\n      const faces = await detectFaces(camera.current.video);\n      var src = camera.current.getScreenshot();\n      var results = await drawResults(\n        camera.current.video,\n        cameraCanvas.current,\n        faces,\n        \"boxLandmarks\",\n        src,\n        facecanvas,\n        model\n      )\n\n      var expressions = [\"angry\", \"disgusted\", \"afraid\", \"happy\", \"sad\", \"surprised\", \"neutral\"]\n\n      if (results !== undefined) {\n        var max = results.reduce(function (a, b) {\n          return Math.max(a, b);\n        });\n        var index = results.indexOf(max)\n        setoutput(expressions[index])\n\n      }\n      setResult(faces);\n\n    }\n  };\n  var model = null\n  var modelLastUpdated = null;\n  const aspectRatio = window.innerWidth / window.innerHeight\n\n  const getExpression = () => {\n    setexpression(output)\n    if (camera) {\n      var src = camera.current.getScreenshot();\n    }\n    setvideo(false)\n    setcurrent(src)\n\n\n  }\n\n  const reCapture = () => {\n    setvideo(true)\n  }\n\n\n\n  const loadmodel = async () => {\n    console.log(window.innerWidth, \"innnnnnnner\")\n    if ('indexedDB' in window) {\n      try {\n        model = await tf.loadLayersModel('indexeddb://' + INDEXEDDB_KEY);\n\n      }\n      catch (e) {\n        console.log(e)\n        model = await tf.loadLayersModel(MODEL_PATH);\n        model.save('indexeddb://' + INDEXEDDB_KEY)\n\n      }\n    }\n    // If no IndexedDB, then just download like normal.\n    else {\n      console.warn('IndexedDB not supported.');\n      model = await tf.loadLayersModel(MODEL_PATH);\n    }\n    setmodelLoaded(true)\n    console.log(\"model loaded\")\n  }\n\n\n\n  const camera = useRef();\n  const cameraCanvas = useRef();\n  const facecanvas = useRef()\n  const [result, setResult] = useState([]);\n  const [isDownloadingModel, setisDownloadingModel] = useState(true)\n  const [modelLoaded, setmodelLoaded] = useState(false)\n  const [output, setoutput] = useState(\"\")\n  const [expression, setexpression] = useState(\"\")\n  const [current, setcurrent] = useState(null)\n  const [video, setvideo] = useState(true)\n  const [mode, setMode] = useState(false)\n\n\n  return (\n\n\n    <div>\n      {isDownloadingModel && <div style={{ textAlign: \"center\", marginTop: \"30vh\" }}>\n        <img src={loading} />\n        <h2 style={{ color: \"#007c6c\" }}>Downloading Model</h2>\n\n      </div>}\n\n      {!isDownloadingModel && <div>\n\n        <div className=\"titleDiv\">\n\n          <div style={{ marginLeft: \"10px\", marginTop: \"1vh\" }}>\n            <h4 style={{ fontSize: \"4vh\" }}>Facial Emotion Detector</h4>\n\n\n\n            <a className=\"nostyle\" href={\"https://github.com/amilkh/cs230-fer\"}>Deep learning model</a>\n            <p className=\"nostyle\">&nbsp;by&nbsp;</p>\n            <a className=\"nostyle\" href={\"https://cs230.stanford.edu/\"}>Stanford University</a>\n            <br />\n\n\n\n            <a className=\"nostyle\" href={\"https://github.com/amilkh/cs230-fer/tree/master/webapp\"}>Web app</a>\n            <p className=\"nostyle\">&nbsp;by&nbsp;</p>\n            <a className=\"nostyle\" href={\"https://se.neduet.edu.pk/\"}>NED University</a>\n\n\n\n            <div style={{ marginLeft: aspectRatio > 1 ? \"92vw\" : \"80vw\" }}>\n              <Switch\n                onChange={() => { setMode(!mode); reCapture() }}\n                uncheckedIcon={<FontAwesomeIcon style={{ marginLeft: \"8px\", marginTop: \"5px\" }} icon=\"video\" />}\n                checkedIcon={<FontAwesomeIcon style={{ marginLeft: \"10px\", marginTop: \"5px\" }} icon=\"camera\" />}\n                checked={!mode}\n                className=\"App__switcher-switch\"\n                offColor={\"#b3f5e5\"}\n                onColor={\"#b3f5e5\"}\n                width={60}\n              />\n            </div>\n\n          </div>\n\n\n\n\n\n\n\n        </div>\n\n\n\n        <div className=\"camera\" align=\"center\">\n          <div id=\"cam_input\">\n            <div style={{ display: video ? \"block\" : \"none\" }}>\n              <Camera camera={camera} cameraCanvas={cameraCanvas} />\n            </div>\n            {!video && <img className=\"camera\" src={current} />}\n          </div>\n          {!mode && <div>\n            {video && <button style={{ width: aspectRatio > 1 ? (window.innerWidth / 100) * 80 : \"33vh\" }} className=\"detect\" onClick={() => getExpression()}>Detect My Emotion</button>}\n            {!video && <button style={{ width: aspectRatio > 1 ? (window.innerWidth / 100) * 80 : \"33vh\" }} className=\"detect\" onClick={() => reCapture()}>Capture Again</button>}\n          </div>}\n        </div>\n\n\n\n\n        <div className=\"footer\">\n          {mode && output !== \"\" && <h3>I think you look {output}.</h3>}\n          {!mode && expression !== \"\" && <h3>I think you look {expression}.</h3>}\n\n        </div>\n\n\n      </div>}\n    </div>\n\n  );\n\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}